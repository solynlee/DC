<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>腾讯地图加载器</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        #mapContainer {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="mapContainer"></div>
    
    <!-- 直接加载腾讯地图-->
    <script src="https://map.qq.com/api/js?v=2.exp&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77"></script>
    
    <script>
        // 等待来自父窗口的配置
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'initMap') {
                initTencentMap(event.data.config);
            }
        });

        function initTencentMap(config) {
            try {
           
                
                // 创建地图
                var map = new qq.maps.Map(document.getElementById('mapContainer'), {
                    center: new qq.maps.LatLng(config.latitude, config.longitude),
                    zoom: config.zoom || 16,
                    mapTypeId: qq.maps.MapTypeId.ROADMAP
                });

                // 添加标记点
                var marker = new qq.maps.Marker({
                    position: new qq.maps.LatLng(config.latitude, config.longitude),
                    map: map
                });

                // 添加信息窗口
                var infoWindow = new qq.maps.InfoWindow({
                    map: map
                });

                infoWindow.setContent(
                    '<div style="padding: 8px;">' +
                    '<h4 style="margin: 0 0 4px 0; font-size: 14px; font-weight: bold;">' + (config.title || '位置信息') + '</h4>' +
                    '<p style="margin: 0; font-size: 12px; color: #666;">' + config.address + '</p>' +
                    '</div>'
                );

                // 默认显示信息窗口
                infoWindow.open();
                infoWindow.setPosition(marker.getPosition());
                
                // 点击标记重新打开信息窗口（防止用户关闭后需要重新打开）
                qq.maps.event.addListener(marker, 'click', function() {
                    infoWindow.open();
                    infoWindow.setPosition(marker.getPosition());
                });

                // 通知父窗口地图加载完成
                window.parent.postMessage({
                    type: 'mapReady',
                    success: true
                }, '*');

                
                
            } catch (error) {
         
                window.parent.postMessage({
                    type: 'mapReady',
                    success: false,
                    error: error.message
                }, '*');
            }
        }

        // 通知父窗口API已准备就绪
        function checkAndNotifyReady() {
            if (window.qq && window.qq.maps && window.qq.maps.Map) {
                window.parent.postMessage({
                    type: 'apiReady'
                }, '*');
            } else {
                setTimeout(checkAndNotifyReady, 100);
            }
        }
        
        // 开始检查API是否就绪
        checkAndNotifyReady();
    </script>
</body>
</html>
