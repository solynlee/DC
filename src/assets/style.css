/* 恢复固定根字体大小，配合手动缩放控制 */
html {
    font-size: 16px !important; /* 基准字体大小，配合缩放比例 */
    -webkit-text-size-adjust: 100% !important; /* 禁止 Safari 自动调整文本大小 */
    text-size-adjust: 100% !important; /* 标准属性，兼容其他浏览器 */
}

@import "tailwindcss";

/* 添加缺失的动画工具类 */
@layer utilities {
    .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    .animate-spin {
        animation: spin 1s linear infinite;
    }

    .animate-ping {
        animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
    }

    .animate-bounce {
        animation: bounce 1s infinite;
    }

    @keyframes pulse {
        0%,
        100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    @keyframes ping {
        75%,
        100% {
            transform: scale(2);
            opacity: 0;
        }
    }

    @keyframes bounce {
        0%,
        100% {
            transform: translateY(-25%);
            animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
        }
        50% {
            transform: none;
            animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
        }
    }
}

@layer base {
    *,
    ::before,
    ::after {
        box-sizing: border-box;
    }
    html {
        width: 100%;
        height: auto;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        scroll-behavior: smooth;
    }
    body {
        width: 100%;
        height: auto;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        /* font-family: "AlibabaPuHuiTi-3"; */
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        letter-spacing: 0.05em; /* 增加字符间距，相当于 tracking-wider */
        /* 禁用过度滚动的弹性效果 */
        overscroll-behavior: none;
    }
    #app {
        width: 100%;
        /* height和min-height完全由JavaScript控制 */
        overflow-x: hidden;
        position: relative;
        transform-origin: top center;
    }

    video,
    canvas,
    svg {
        display: block;
        max-width: 100%;
        height: auto;
    }
    a {
        text-decoration: none;
        color: inherit;
        /* 平滑的颜色过渡 */
        transition: color 0.1s ease-in-out;
    }
    button,
    input,
    textarea,
    select {
        font: inherit;
        color: inherit;
        /* 平滑的交互效果 */
        transition: all 0.1s ease-in-out;
    }
    ul,
    ol {
        list-style: none;
        padding: 0;
        margin: 0;
    }
}

/* 全局动画优化 */
@layer utilities {
    /* 减少动画的性能消耗 */
    .will-change-transform {
        will-change: transform;
    }

    .will-change-opacity {
        will-change: opacity;
    }

    /* 硬件加速 */
    .gpu-accelerated {
        transform: translateZ(0);
        backface-visibility: hidden;
        perspective: 1000px;
    }

    /* 平滑滚动 */
    .smooth-scroll {
        scroll-behavior: smooth;
    }

    /* 自定义缓动函数 */
    .ease-out-quart {
        transition-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    .ease-in-out-quart {
        transition-timing-function: cubic-bezier(0.77, 0, 0.175, 1);
    }
}

/* 页面加载优化 */
@layer utilities {
    /* 防止页面加载时的布局闪烁 */
    .prevent-layout-shift {
        contain: layout style paint;
    }

    /* 图片加载优化 */
    img {
        /* 防止图片加载时的布局位移 */

        /* 启用硬件加速 */
        transform: translateZ(0);
        /* 平滑的透明度过渡 */
        transition: opacity 0.15s ease-in-out;
    }

    /* 响应式高度过渡 */
    .height-auto-transition {
        transition: height 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    /* 内容可见性优化 */
    .content-visibility-auto {
        content-visibility: auto;
        contain-intrinsic-size: 0 500px;
    }

    /* 确保下拉菜单容器有正确的溢出处理 */
    .el-menu--horizontal {
        overflow: visible !important;
    }

    /* Element Plus popper 组件优化 - 创建独立的定位上下文 */
    .el-popper {
        z-index: 9999 !important;
        /* 使用viewport相对单位，避免受父元素transform影响 */
        position: fixed !important;
        /* 重要：确保不受外层容器transform影响 */
        will-change: transform;
        /* 禁用pointer-events以防止事件冲突 */
        pointer-events: auto !important;
    }

    /* Element Plus组件堆叠优化 */
    .el-menu--horizontal .el-sub-menu .el-menu--popup {
        z-index: 9999 !important;
        position: fixed !important;
        /* 确保下拉菜单不受zoom影响 */
        transform-origin: top left !important;
    }

    /* 修复缩放环境下的菜单定位问题 */
    .proportional-scaling-active .el-popper,
    .proportional-scaling-active .el-menu--popup {
        /* 重置zoom影响，使用独立定位 */
        zoom: 1 !important;
        transform: scale(1) !important;
        /* 固定定位确保不受父容器影响 */
        position: fixed !important;
    }
}

/* wangEditor 样式优化 */
@layer base {
    /* 确保 wangEditor 的样式不被覆盖 */
    .w-e-text-container,
    .w-e-text-placeholder,
    .w-e-text {
        font-family: inherit !important;
    }
}

/* 富文本内容样式 - 覆盖 Tailwind 的样式重置 */
@layer components {
    /* 富文本编辑器内容样式 */
    .rich-text-content {
        /* 段落样式 */
        p {
            margin-bottom: 1rem;
            line-height: 1.6;
            color: inherit;
        }

        /* 标题样式 */
        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin: 1.5rem 0 1rem 0;
            line-height: 1.2;
            color: inherit;
        }

        h2 {
            font-size: 1.75rem;
            font-weight: 600;
            margin: 1.25rem 0 0.75rem 0;
            line-height: 1.3;
            color: inherit;
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 1rem 0 0.5rem 0;
            line-height: 1.4;
            color: inherit;
        }

        h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0.75rem 0 0.5rem 0;
            line-height: 1.4;
            color: inherit;
        }

        h5 {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0.75rem 0 0.5rem 0;
            line-height: 1.4;
            color: inherit;
        }

        h6 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0.75rem 0 0.5rem 0;
            line-height: 1.4;
            color: inherit;
        }

        /* 列表样式 */
        ul {
            list-style: disc;
            margin: 1rem 0;
            padding-left: 2rem;
        }

        ol {
            list-style: decimal;
            margin: 1rem 0;
            padding-left: 2rem;
        }

        li {
            margin: 0.5rem 0;
            line-height: 1.6;
        }

        /* 嵌套列表 */
        ul ul,
        ol ol,
        ul ol,
        ol ul {
            margin: 0.25rem 0;
        }

        ul ul {
            list-style-type: circle;
        }

        ul ul ul {
            list-style-type: square;
        }

        /* 链接样式 */
        a {
            color: #2563eb;
            text-decoration: underline;
            transition: color 0.2s ease;
        }

        a:hover {
            color: #1d4ed8;
        }

        /* 强调样式 */
        strong,
        b {
            font-weight: 700;
        }

        em,
        i {
            font-style: italic;
        }

        /* 引用样式 */
        blockquote {
            border-left: 4px solid #e5e7eb;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background-color: #f9fafb;
            font-style: italic;
            color: #6b7280;
        }

        /* 代码样式 */
        code {
            background-color: #f3f4f6;
            color: #374151;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.875em;
            font-family: "Courier New", Courier, monospace;
        }

        pre {
            background-color: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            overflow-x: auto;
            font-family: "Courier New", Courier, monospace;
        }

        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }

        /* 分割线 */
        hr {
            border: none;
            border-top: 1px solid #e5e7eb;
            margin: 2rem 0;
        }

        /* 图片样式 */
        img {
            max-width: 100%;
            height: auto;
            margin: 1rem 0;
            border-radius: 0.5rem;
        }

        /* 表格样式 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            border: 1px solid #e5e7eb;
        }

        th,
        td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            border-right: 1px solid #e5e7eb;
        }

        th {
            background-color: #f9fafb;
            font-weight: 600;
        }

        tr:last-child td {
            border-bottom: none;
        }

        th:last-child,
        td:last-child {
            border-right: none;
        }

        /* 统一表格布局 - 解决不同浏览器宽度不一致问题 */
        .table-fixed {
            table-layout: fixed !important;
        }

        .table-fixed th,
        .table-fixed td {
            overflow: hidden;
            word-wrap: break-word;
            hyphens: auto;
        }

        /* Safari特殊处理 */
        @supports (-webkit-appearance: none) {
            .table-fixed {
                -webkit-table-layout: fixed;
                table-layout: fixed;
            }

            .table-fixed th,
            .table-fixed td {
                -webkit-hyphens: auto;
                hyphens: auto;
                -webkit-word-break: break-word;
                word-break: break-word;
            }
        }

        /* 视频样式 */
        video {
            max-width: 100%;
            height: auto;
            margin: 1rem 0;
        }

        /* 确保所有文本元素都有合适的行高和间距 */
        * {
            line-height: inherit;
        }

        /* 处理嵌套元素的间距 */
        > *:first-child {
            margin-top: 0;
        }

        > *:last-child {
            margin-bottom: 0;
        }

        /* wangEditor 特定样式支持 */
        .w-e-text-container,
        .w-e-text-placeholder,
        .w-e-text {
            p,
            h1,
            h2,
            h3,
            h4,
            h5,
            h6,
            ul,
            ol,
            li,
            blockquote,
            pre,
            code,
            img,
            table,
            th,
            td,
            hr {
                all: revert;
            }
        }

        /* 确保文本颜色继承 */
        * {
            color: inherit;
        }

        /* 特殊格式支持 */
        .text-align-left {
            text-align: left !important;
        }
        .text-align-center {
            text-align: center !important;
        }
        .text-align-right {
            text-align: right !important;
        }
        .text-align-justify {
            text-align: justify !important;
        }

        /* 字体大小支持 */
        .font-size-12 {
            font-size: 12px !important;
        }
        .font-size-14 {
            font-size: 14px !important;
        }
        .font-size-16 {
            font-size: 16px !important;
        }
        .font-size-18 {
            font-size: 18px !important;
        }
        .font-size-20 {
            font-size: 20px !important;
        }
        .font-size-24 {
            font-size: 24px !important;
        }
        .font-size-28 {
            font-size: 28px !important;
        }
        .font-size-32 {
            font-size: 32px !important;
        }

        /* 行高支持 */
        .line-height-1 {
            line-height: 1 !important;
        }
        .line-height-1-2 {
            line-height: 1.2 !important;
        }
        .line-height-1-5 {
            line-height: 1.5 !important;
        }
        .line-height-1-8 {
            line-height: 1.8 !important;
        }
        .line-height-2 {
            line-height: 2 !important;
        }

        /* 字体颜色支持 */
        .color-red {
            color: #f56565 !important;
        }
        .color-orange {
            color: #ed8936 !important;
        }
        .color-yellow {
            color: #ecc94b !important;
        }
        .color-green {
            color: #48bb78 !important;
        }
        .color-blue {
            color: #4299e1 !important;
        }
        .color-purple {
            color: #9f7aea !important;
        }
        .color-gray {
            color: #a0aec0 !important;
        }
        .color-black {
            color: #1a202c !important;
        }

        /* 背景颜色支持 */
        .bg-color-red {
            background-color: #fed7d7 !important;
        }
        .bg-color-orange {
            background-color: #feebc8 !important;
        }
        .bg-color-yellow {
            background-color: #fefcbf !important;
        }
        .bg-color-green {
            background-color: #c6f6d5 !important;
        }
        .bg-color-blue {
            background-color: #bee3f8 !important;
        }
        .bg-color-purple {
            background-color: #e9d8fd !important;
        }
        .bg-color-gray {
            background-color: #edf2f7 !important;
        }
    }
}

/* 全局过渡效果 */
@layer components {
    /* 页面容器基础样式 */
    .page-container {
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
    }

    /* 内容区域动画进入效果 */
    .content-enter {
        animation: contentSlideIn 0.6s ease-out forwards;
    }

    @keyframes contentSlideIn {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* 悬停效果增强 */
    .hover-lift {
        transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
    }

    .hover-lift:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
}

/* 统一比例缩放布局样式 - 所有设备都使用相同的缩放方案 */
@layer base {
    /* 所有设备都启用比例缩放 */
    html {
        overflow-x: hidden;
        overflow-y: scroll;
        height: auto;
        min-height: 100vh;
    }

    body {
        overflow-x: hidden;
        overflow-y: visible;
        margin: 0;
        padding: 0;
        height: auto;
        min-height: 100vh;
    }

    /* 比例缩放状态下的统一优化 */
    .proportional-scaling-active {
        width: 100%;
        /* 移除height: auto，让JavaScript控制 */
        overflow-y: visible;
    }

    .proportional-scaling-active #app {
        position: relative;
        transform-origin: top left;
        -webkit-transform-origin: top left;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        text-size-adjust: none;
        -webkit-text-size-adjust: none;
        transition: none !important;
        -webkit-transition: none !important;

        /* Safari 3D渲染优化 */
        -webkit-transform-style: preserve-3d;
        transform-style: preserve-3d;
        -webkit-perspective: 1000px;
        perspective: 1000px;

        /* 优化Safari渲染性能 */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    /* Safari transform缩放时的特殊处理 */
    @supports (-webkit-appearance: none) {
        .proportional-scaling-active html,
        .proportional-scaling-active body {
            /* 强制Safari使用正确的高度，由JavaScript设置 */
            overflow-y: auto !important;
            overflow-x: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
            /* 防止任何其他规则覆盖高度 */
            height: var(--safari-body-height, auto) !important;
        }

        .proportional-scaling-active #app {
            /* 确保在transform缩放时app容器占满整个视口 */
            position: relative;
            box-sizing: border-box;
        }
    }
}
